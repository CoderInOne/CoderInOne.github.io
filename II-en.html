<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8"/>
    <title>II-IIIA stage</title>
    <script src="script/jquery-3.5.1.min.js"></script>
    <script src="script/math.min.js"></script>
</head>
<body>
<!-- Header -->
<header id="header">
    <div id="header_container" style="height:100%; width:100%; overflow: hidden;">
        <!-- <div id="logo" style="float: left; width:25%;">
            <a href="#intro"><img src="img/logo.JPG" alt="" title=""></a>
        </div> -->

        <div style="float: left; width: 300px; height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;" >
            <div id="home" style="float: left; width:30%;">
                <a href="index-en.html">Home</a>
            </div>

            <div id="language" style="float: left; width:70%;">
                <a href="II.html">中文版</a>
            </div>
        </div>
    </div>
</header>

<!--主表单-->
<form id="form" autocomplete="off" onsubmit="return false">
    <!--性别-->
    <div>
        1. sex
    </div>

    <p></p>

    <fieldset>
        <input type="radio" name="sex" id="man" value="28.12598" checked>
        <label for="man">male</label>
        <input type="radio" name="sex" id="women" value="0">
        <label for="women">female</label>
    </fieldset>
    <p></p>

    <!--年龄-->
    <div>
        2. age (years)
    </div>

    <p></p>

    <fieldset>
        <input type="radio" name="age" id="1" value="0" checked>
        <label for="1"><60</label>
        <input type="radio" name="age" id="2" value="42.3163">
        <label for="2">60-69</label>
        <input type="radio" name="age" id="3" value="65.41746">
        <label for="3">>=70</label>
    </fieldset>
    <p></p>


    <!--组织学-->
    <div>
        3. histologic type
    </div>

    <p></p>
    <fieldset>
        <input type="radio" name="zz" id="z1" value="26.2555" checked>
        <label for="z1">adenocarcinoma</label>
        <input type="radio" name="zz" id="z2" value="0">
        <label for="z2">squamous cell carcinoma</label>
        <input type="radio" name="zz" id="z3" value="40.85534">
        <label for="z3">other</label>
    </fieldset>

    <!--组织学-->
    <div>
        4. grade
    </div>

    <p></p>
    <fieldset>
        <input type="radio" name="level" id="l1" value="0" checked>
        <label for="l1">I</label>
        <input type="radio" name="level" id="l2" value="45.2995">
        <label for="l2">II</label>
        <input type="radio" name="level" id="l3" value="68.53008">
        <label for="l3">III-IV</label>
    </fieldset>

    <!--部位-->
    <div>
        5. tumor site
    </div>

    <p></p>
    <fieldset>
        <input type="radio" name="site" id="site1" value="0" checked>
        <label for="site1">upper lobe</label>
        <input type="radio" name="site" id="site2" value="8.823165">
        <label for="site2">middle lobe</label>
        <input type="radio" name="site" id="site3" value="36.107184">
        <label for="site3">lower lobe</label>
    </fieldset>

    <!--淋巴结采样数目-->
    <div>
        6. number of examined lymph nodes
    </div>

    <p></p>
    <fieldset>
        <input type="radio" name="lb" id="lb1" value="25.10972" checked>
        <label for="lb1"><16</label>
        <input type="radio" name="lb" id="lb2" value="0">
        <label for="lb2">>=16</label>
    </fieldset>

    <div>
        6. TNM stage
    </div>

    <p></p>
    <fieldset>
        <input type="radio" name="TNM" id="TNM1" value="0" checked>
        <label for="TNM1">IIA</label>
        <input type="radio" name="TNM" id="TNM2" value="55.80679">
        <label for="TNM2">IIB</label>
        <input type="radio" name="TNM" id="TNM3" value="100">
        <label for="TNM3">IIIA</label>
    </fieldset>

    <!--治疗方案-->
    <div>
        7. treatment strategy
    </div>

    <p></p>
    <fieldset>
        <input type="radio" name="zl" id="zl1" value="0" checked>
        <label for="zl1">lobectomy+chemotherapy</label>
        <input type="radio" name="zl" id="zl3" value="51.44187">
        <label for="zl3">other</label>
    </fieldset>
    <p></p>

    <!--8.已经存活的时间x年-->
    <div>
        8. patient has survived x years
    </div>

    <p></p>
    <fieldset>
        <input type="radio" name="x" id="live0" value="0" checked>
        <label for="live0">0</label>
        <input type="radio" name="x" id="live1" value="1">
        <label for="live1">1</label>
        <input type="radio" name="x" id="live2" value="2">
        <label for="live2">2</label>
        <input type="radio" name="x" id="live3" value="3">
        <label for="live3">3</label>
        <input type="radio" name="x" id="live4" value="4">
        <label for="live4">4</label>
        <input type="radio" name="x" id="live5" value="5">
        <label for="live5">5</label>
    </fieldset>

    <!--
    1.性别：男or女
    2.年龄：<60,60-69,>=70
    3.组织学：腺癌, 原位腺癌或微浸润腺癌, 鳞癌, 其他
    4.分级：I,  II, III-IV
    5.淋巴结采样数目：<16, >=16
    6.TNM分期：IA1, IA2, IA3, IB
    7.治疗方案：肺叶切除术，肺段切除术，楔形切除术，手术+放疗和/或化疗
    8.已经存活的时间x年：0，1，2，3，4，5
    9.期望的额外存活时间y年：1，2，3，4，5

    1.性别=“女”：0；性别=“男“：26.54548
    2.年龄=“<60”：0；年龄= “60-69”：31.40455；年龄= “ >=70”：65.27106
    3.组织学=“腺癌”：26.33914；组织学=“原位腺癌或微浸润腺癌”：0；组织学=“鳞癌”： 27.33178；组织学=“其他”：33.2276
    4.分级=“I”：0；分级=“II”：71.71349；分级=“III-IV”：100
    5.淋巴结采样数目=“ <16”：37.03084；淋巴结采样数目=“ >=16”：0
    6. TNM分期=“ IA1”：0；TNM分期=“ IA2”： 30.11456； TNM分期=“IA3”： 65.81319； TNM分期=“IB”： 70.52046
    7.治疗方案=“肺叶切除术”：0；治疗方案=“肺段切除术”： 38.54706；治疗方案=“楔形切除术”： 50.13435；治疗方案=“手术+放疗和/或化疗”： 59.38025

    -->

    <!--9.期望的额外存活时间y年-->
    <div>
        9. patient expects to survive for another y years
    </div>

    <p></p>
    <fieldset>
        <input type="radio" name="y" id="elive1" value="1" checked>
        <label for="elive1">1</label>
        <input type="radio" name="y" id="elive2" value="2">
        <label for="elive2">2</label>
        <input type="radio" name="y" id="elive3" value="3">
        <label for="elive3">3</label>
        <input type="radio" name="y" id="elive4" value="4">
        <label for="elive4">4</label>
        <input type="radio" name="y" id="elive5" value="5">
        <label for="elive5">5</label>
    </fieldset>

    <br>

    <!--提交-->
    <div class="form-group row" id="submit">
        <div>
            <input type="submit" name="Submit" value="计算" class="submit_button" id="calc_pred_button">
        </div>
    </div>
</form>

<p></p>

<div>
    <p>y-year conditional survival given that the patient has survived x years:</p>
    <label id="result"></label>
</div>

<script>
    function calculate(formula, points) {
        var finalFormula = formula.split('points').join(points);
        return math.evaluate(finalFormula);
    }

    $("#form").submit(function (e) {
        e.preventDefault();
        var data = $("form").serializeArray();
        console.log(data);

        // points
        var points = 0;
        var x = 0;
        var y = 0;
        data.forEach(function (item) {
            if (item['name'] === 'x') {
                x = parseInt(item['value']);
                console.log('x=' + x);
                // 不算分
                return;
            }

            if (item['name'] === 'y') {
                y = parseInt(item['value']);
                console.log('y=' + y);
                // 不算分
                return;
            }

            points += parseFloat(item['value']);
        });
        console.log("points=" + points);

        // z
        var z = x + y;

        // ES
        var ES = 0;
        switch (z) {
            case 10:
                ES = calculate('1.2e-08 * points ^ 3 + -9.915e-06 * points ^ 2 + 0.000315349 * points + 0.822235095', points);
                break;
            case 9:
                ES = calculate('1.1e-08 * points ^ 3 + -9.492e-06 * points ^ 2 + 0.000292917 * points + 0.830310296', points);
                break;
            case 8:
                ES = calculate('1.1e-08 * points ^3 + -9.482e-06 * points ^2 + 0.000375807 * points + 0.83040918', points);
                break;
            case 7:
                ES = calculate('1e-08 * points ^3 + -9.08e-06 * points ^2 + 0.000380008 * points + 0.838061119', points);
                break;
            case 6:
                ES = calculate('9e-09 * points ^3 + -8.482e-06 * points ^2 + 0.000368428 * points + 0.847570874', points);
                break;
            case 5:
                ES = calculate('7e-09 * points ^3 + -7.734e-06 * points ^2 + 0.000366603 * points + 0.858193891', points);
                break;
            case 4:
                ES = calculate('5e-09 * points ^3 + -6.427e-06 * points ^2 + 0.000288484 * points + 0.878237158', points);
                console.log("1", ES);
                break;
            case 3:
                ES = calculate('2e-09 * points ^3 + -4.553e-06 * points ^2 + 0.000151677 * points + 0.904135814', points);
                break;
            case 2:
                ES = calculate('-2e-09 * points ^3 + -2.019e-06 * points ^2 + -8.0196e-05 * points + 0.941737405', points);
                break;
            case 1:
                ES = calculate('-4e-09 * points ^3 + 4.11e-07 * points ^2 + -0.000273171 * points + 0.984592428', points);
                console.log("1", ES);
                break;
            default:
                break;
        }
        console.log('ES=' + ES);
        if (ES > 1) {
            ES = 1;
        }

        // AS
        var AS = 0;
        switch (x) {
            case 0:
                AS = 1;
                break;
            case 1:
                AS = calculate('-4e-09 * points ^3 + 4.11e-07 * points ^2 + -0.000273171 * points + 0.984592428', points);
                break;
            case 2:
                AS = calculate('-2e-09 * points ^3 + -2.019e-06 * points ^2 + -8.0196e-05 * points + 0.941737405', points);
                break;
            case 3:
                AS = calculate('2e-09 * points ^3 + -4.553e-06 * points ^2 + 0.000151677 * points + 0.904135814', points);
                break;
            case 4:
                AS = calculate('5e-09 * points ^3 + -6.427e-06 * points ^2 + 0.000288484 * points + 0.878237158', points);
                break;
            case 5:
                AS = calculate('7e-09 * points ^3 + -7.734e-06 * points ^2 + 0.000366603 * points + 0.858193891', points);
                break;
            default:
                break;
        }
        console.log("AS=" + AS);
        if (AS > 1) {
            AS = 1;
        }

        // 生存率CS
        var CS = ES * 100 / AS;
        console.log("CS=" + CS);

        $("#result").text(CS.toFixed(1) + '%');
    })
</script>
</body>
</html>